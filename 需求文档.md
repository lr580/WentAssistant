> 系统工程略、可行性分析略；不按标准来写，随心所欲的原始级/可重复级 QwQ

## 功能需求

> 懒得细分了，性能需求什么的也一起塞在这里吧

以下需求为 V2.0 版本需求

### 概述

#### 当前版本需求

当前版本实现成为 V2.0 版本

1. 基于MySQL的完整的分类记账和统计功能，复杂度不超过 $O(n\log n)$ 
2. 实现逐步撤销重做和较高效的保存取消
3. 实现备份、导入导出(含旧版本导入)功能

#### 未来版本需求

> 以下所有需求待定，暂时不作细化

1. 能够基于模块方式从一个抽象类快速拓展出其他记录数据表增删改查等操作，包括：
   1. 实现 IMOT 记录存取
   2. 实现 `rD` 记录存取
   3. 实现计时器和周期任务
   4. 实现备忘录



### 类别功能

其他功能的前置功能之一，用于分类

要求必须实现的有：

1. 基于树实现类别的父子关系

   不基于DAG实现多继承，规定节点只能有一个父亲

   有根节点和特殊子节点：未分类

2. 动态维护类别的单点创建、单点删除、单点编辑

   删除后原节点编号不能被复用，在其他模块实现判定已被删除转化为未分类

3. 实现类别的单点和子树查询

4. 能够树状图形化展示和管理类别，将编辑独立窗口可随时嵌入其他模块使用

5. (扩展)点带权，可以按权值列表排序(此时看成顺序表即可，不考虑子树权作点权)，这个权可以代表记录数



估计实际一个类别中可能会有不超过100个节点，需要有较高的性能，复杂度不能大于等于立方复杂度



### 控制通用功能

#### 逐步操作记录

1. 每进行一次更改型操作都将记录更改指令，满足：
   - 对相同数据执行相同指令序列，必然得到相同的结果
   - 每一条指令均可逆
2. 可以撤销一步和撤销所有步，重做一步和重做所有步，特别地，撤销后再次进行新的操作会清空重做，否则重做不清空
3. 支持可以选择关闭的指令序列日志文件自动保存功能，每次操作后追加保存，而不是关闭程序再保存



#### 保存和取消

1. 进行保存操作，逐条执行当前的指令序列，永久保存当前操作
2. 进行取消保存操作，遗弃当前指令序列



#### 备份和导入导出

1. 可以整个备份当前数据库
2. 可以还原当前数据库到特定备份
3. 可以将整个数据库或指定数据表以 `sql` 格式导出
4. 可以将满足格式的数据库整个导入覆盖，不满足格式的进行报错
5. 可以将特定格式的普通文本进行批量导入



#### 数据库连接

1. 可以设置自动连接或取消自动，更改数据库连接



#### 访问控制

1. 登录本程序需要密码，输入容错次数为3次，(可选)不设错误次数限制

   也可以设置回答特定问题

2. 可以关闭和修改密码



### 记账功能

#### 录入

1. 单项记录含序号、金额(实数)、日期(六位数字)、类型、备注、(更改日期)
2. 支持单项录入，输入对应内容(上下键翻动输入框，任意地方回车或`ctrl+i`录入)
3. 支持多项录入，使用多项录入定义的语法：(可以设置勾选单项/多项)
   1. 有一个编辑框有空格隔开的多项数据，按照这个顺序批量录入，其他编辑框内容恒定
   2. 有多个编辑框有多项数据，每次录入后有多项的各自往后推一项；最终以金额的数量作为录入项数目
   3. 日期编辑框空格加上 `+数字x 数字y` ，代表从当前这一天开始，每 $x$ 天增加 $y$ 天； $y$ 缺省值为 $1$ (但是小于 $x$ 天累积时不变)；有这种格式时不能有多重日期
   4. (主要是备注用)若不加上\|符号，代表该项只出现一次(在当前位置对应)，随后永久不出现；若加上 `|数字` ，代表第 `数字` 项为备注(下标从0开始)
   4. 若命令框含内容 -C 开头的，后面以空格为间隔获取类别周期
4. 缺省时日期是当天，类型是未分类，金额必填
5. 可以设置录入后是否清空编辑框
6. 任意操作成功后可以在一行状态栏显示结果



#### 管理

1. 单项编辑，选中项后编辑框自动录入该项内容，可以设置快捷键ctrl+u
2. 不定项删除，多选删除即可，不弹窗警告，可以设置快捷键ctrl+d



#### 显示

有项目栏：

1. 默认不展示任何内容

2. 表格支持按列排序

3. 若首次插入清空表格，插入后在表格插入一行 (状态为更新项表格) 

4. 可以支持自定义缩放列宽

   但没有必要支持移动列相对顺序乃至删列

> 废置需求：没必要显示日期栏，而且模块化下实现起来比较麻烦，所以扔掉了这个需求
>
> 有日期栏：
>
> 1. 默认展示近一个月的日期项目(可以修改设置)
> 2. 点击后项目栏展示选中项项目(不必要支持多选，但可以实现)
> 3. 可以正序和倒序排序(可以修改设置)
>



#### 搜索

1. 可以搜索时间范围闭区间的所有项目，格式为 `-t 首参数 末参数`

   时间格式为年月日(各二位数)

   若第二个参数缺省，补上未补全时的第一个参数

   若日缺省，首参数为该月第一天(01)，尾参数为该月最后一天

   若月缺省，首参数为01，未参数为12

   若年缺省(判定小于12是月份)，填现在的年份

2. 可以搜索金额范围闭区间 `-p 最低 最高` 

   第二个参数缺省补足为第一个参数；最低填\*补足负无穷，最高填\*补足为正无穷

3. 可以搜索类型 `-c` ，加若干个参数，表示只包含这些类别及其子类

   类别可以打名字或编号(可能会重名类出现)

   可以搜索 `-n` ，表示只包含这些类型(不包括子类)

   可以搜索 `-C` ，表示只排除这些类别及其子类

   可以搜索 `-N` ，表示只排除这些类别(不包括子类)

   规则可以叠加，默认起点是全集，按从左到右顺序从当前集合筛选

4. 可以搜索备注文本 `-b` ，键入关键词，搜索带这个词语的项目

   可以使用 `-B` ，表示正则表达式 (默认不缺分大小写，可以通过语句或设置更改) 

5. 只键入 `-s` 然后输入SQL语句，直接执行该语句来搜索 (非必须功能)

6. 无参数指令 `-w` 表示只统计工作日，`-W` 表示只统计周末(非必需功能)



#### 统计

1. 基于当前搜索结果进行统计，弹窗展示，允许另存为结果或复制到剪切板
2. 统计结果包括：
   1. 树状表示每个类别的开销(按大小排序)
   2. 表示每个月的开销
   3. 表示开销的平均数和方差
   4. 表示工作日和周末的总数和均数



#### 兼容

1. 支持导入旧版本 V1.0 的全部数据到当前版本

